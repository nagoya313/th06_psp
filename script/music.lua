local kMusicTable = {
  {
    name = '　１、赤より紅い夢', 
    key = 'No1',
    message = 'No1. 赤より紅い夢\n　タイトル画面テーマです。\n  東方なんで、和風にしてみました。いやほんと。\n　ゲームはまるで和風じゃないくせに(^^;\n　ＳＴＧとは思えないような曲です。\n　そももそタイトル画面に曲は必要なのでしょうか（笑）？'
  },
  {
    name = '　２、ほおずきみたいに紅い魂',
    key = 'No2',
    message = 'No2. ほおずきみたいに紅い魂\n　一面テーマです。\n　夜の森もイメージしてあります。一面だし、曲に勇ましさがあると\n　やる気が出るかなと思い、ちょっと元気ある曲を目指しました。\n　勇ましさというかコミカルな百鬼夜行って感じかな？'
  },
  {
    name = '　３、妖魔夜行',
    key = 'No3',
    message = 'No3. 妖魔夜行\n　ルーミアのテーマです。\n　この曲に限らず、今回、全体的に軽快な曲になっています。\n　この曲は夜の妖怪をイメージしました、\n　　　・・・って言っても良いんだろうか(^^;\n　ノリ的には結構\馬鹿っぽいです。'
  },
  {
    name = '　４、ルーネイトエルフ',
    key = 'No4',
    message = 'No4. ルーネイトエルフ\n ２面のテーマです。\n　水と霧をイメージして、ちょっと不気味さも混ぜて見ました。\n　過去の東方のイメージとほとんど同じ感じとも言える。\n　２面って言うと、なんの為にあるのかよく分からないからなぁ(^^;'
  },
  {
    name = '　５、おてんば恋娘',
    key = 'No5',
    message = 'No5. おてんば恋娘\n　チルノのテーマです。\n　やっぱり、頭の悪い少女をイメージしてます。\n　その割には明るいんだか暗いんだか分からない曲に仕上がって\n　なんとも、ハイスピードニしっとりとしたメインメロディとか。\nまぁ、２面だし（ぉ'
  },
  {
    name = '　６、上海紅茶館　～ Chinese Tea',
    key = 'No6',
    message = 'No6. 上海紅茶館　～ Chinese Tea\n　３面テーマです。\n　中華風に仕上げる予定でしたが、結果そんなでも無いようです(^^;\n　でも曲は東洋風です。４面以降に東洋風の曲を作ることが出来なさ\n　そうだったので、ここでつくっときました(^^;\n　Fusionというより New Age風かな？'
  },
  {
    name = '　７、明治十七年の上海アリス',
    key = 'No7',
    message = 'No7. 明治十七年の上海アリス\n　紅　美鈴（ホン・メイリン）のテーマです。\n　欧羅巴の香りとゲーム音楽の香りを混ぜてあります。（2:8位で）\n　中華でも何でも無いあたりがアレです。上海のフランス租界をイメ\n　－ジしているからです。\n　もっとも、美鈴も人間では無いみたいだけど、何物なんだろう（ぉ'
  },
  {
    name = '　８、ヴワル魔法図書館',
    key = 'No8',
    message = 'No8. ヴワル魔法図書館\n　４面テーマです。\nこの面から室内ステージです。曲も室内の雰囲気をだしてみまし\nた。後半、中ボスあたりから不気味さが出るように曲調が変化し\n　ます。\n　それ以外には特に特徴も無いですが、強いていえば、ＳＴＧの曲\n　ではない（笑）'
  },
  {
    name = '　９、ラクトガール　～ 少女密室',
    key = 'No9',
    message = 'No9. ラクトガール　～ 少女密室\n　パチュリー・ノーレッジのテーマです。\n　ああ、またいつもの悪い病気が...\n　暗い曲です。こんなにも激しいのに明るさも軽快さも感じません\n　もうちょっと気持ちよければいいんですが、この曲聴くと微妙に\n　暗い気分になる感じがします（笑）'
  },
  {
    name = '１０、メイドと血の懐中時計',
    key = 'No10',
    message = 'No10. メイドと血の懐中時計\n　５面のテーマです。\n　不思議な不思議な曲です。\n　スピードを出そうとしてつんのめりそ\n　うな曲になってるのは、特殊な拍子のせいでしょうか？\n　ロックにしたかったんですが、私はあまりロックを聴かない所為\n　か、ロックというものを誤解している可能性大(^^;'
  },
  {
    name = '１１、月時計　～ ルナ・ダイアル',
    key = 'No11',
    message = 'No11. 月時計　～ ルナ・ダイアル\n　十六夜　咲夜（いざよい・さくや）のテーマです。\n　メイドさんといえばハードロック（嘘）\n\n　やっぱり誤解してるのかなぁ(^^; >ロック\n　私的詩的ロックということで'
  },
  {
    name = '１２、ツェペシュの幼き末裔',
    key = 'No12',
    message = 'No12. ツェペシュの幼き末裔\n　最終面のテーマです。\n最終面はいつもしっとりさせすぎていたので、今回は軽快なノリ\n　で。短いステージのただのつなぎの曲なので、あまり自己主張\n　させないような曲にしました。'
  },
  {
    name = '１３、亡き王女の為のセプテット',
    key = 'No13',
    message = 'No13. 亡き王女の為のセプテット\n　レミリア・スカーレットのテーマです。\nこれがラストだ！といわんばかりの曲を目指しました。\n　あんまり重厚さを出したり不気味さを出したり、そういうありが\n　ちラストは嫌なので、ジャズフュージョンチックにロリっぽさを\n　混ぜて. . .、ってそれじゃあいつもとあんまり変らんな。\n　このメロディは自分でも理解しやすく、気に入っています。'
  },
  {
    name = '１４、魔法少女達の百年祭',
    key = 'No14',
    message = 'No14. 魔法少女達の百年祭\n　エキストラステージのテーマです。\n　時折中華風です。時折ニューエイジ風です。それはなぜか？ \n　何もテーマも考えずにキーボードを弾いてしまったら、こうなっ\n　てしまいました。\n　私の惰性の集大成見たいな曲です。よく聴くと、謎めいたフレー\n　ズが詰まっています。私のおもちゃ箱ですね。'
  },
  {
    name = '１５、U.N.オーエンは彼女なのか？',
    key = 'No15',
    message = 'No15. U.N.オーエンは彼女なのか？\n　フランドール・スカーレットのテーマです。\n　今回のもっともお気に入りです。いかにして悪魔っ娘を東洋風に\n　かつ、ミステリアスに表\現できるかに挑戦した結果です。\n　ロリっぽいこのメロディは、今作品でももっとも私らしいメロディ\n　で、鍵盤弾くのが楽しかったです。'
  },
  {
    name = '１６、紅より儚い永遠',
    key = 'No16',
    message = 'No16. 紅より儚い永遠\n　エンディングテーマです。\n　曲名から想像つくように、タイトル画面の曲の編曲みたいなもの\n　です。そのため和風です。\n　というか、和風で良いんですが。'
  },
  {
    name = '１７、紅楼　～ Eastern Dream...',
    key = 'No17',
    message = 'No17. 紅楼　～ Eastern Dream...\n スタッフロールのテーマです。\n　いつもは絶望的に暗い曲ばっかのスタッフロールでしたが、今回\n　は希望的に明るくしました。多分。\n　相変わらずスタッフが少ないので、あまり長い曲には出来ません。\n　もっと壮大な曲でも良かったんですが、割と印ルーム名印象の\n　曲になりました。これは意図していません（笑）'
  }
}
local kMusicRoomBackImageFileName = 'image/music.dds'
local kMusicRoomObjectImageFileName = 'image/music00.dds'

local function init()
  add_back_image('music', kMusicRoomBackImageFileName)
  add_image('room', kMusicRoomObjectImageFileName)
  resize_actor('room', 256, 64)
  move_actor('room', 16, 0)
  set_actor_uv('room', 0, 0, 256, 64)
  for i, element in ipairs(kMusicTable) do
    add_text(element.name, 16, 60 + 16 * i, element.name)
    add_text(element.key, 48, 192, element.message)
    resize_actor(element.name, 0.8, 0)
    resize_actor(element.key, 0.7, 0)
    set_actor_color(element.key, 0xAA, 0xAA, 0xFF)
  	if i == 1 then
      set_actor_color(element.name, 0xAA, 0xAA, 0xFF)
    else
      set_actor_color(element.name, 0x64, 0x64, 0x80)
    end
    if i ~= 1 then
      sleep_actor(element.key)
    end
    if i > 7 then
      sleep_actor(element.name)
    end
  end
end

local function clean()
  erase_actor('music')
  erase_actor('room')
  erase_actor('name')
  for i, element in ipairs(kMusicTable) do
    erase_actor(element.name)
    erase_actor(element.key)
  end
end

local function select_down(music_select)
  sleep_actor(kMusicTable[music_select].key)
  set_actor_color(kMusicTable[music_select].name, 0x64, 0x64, 0x80)
  music_select = music_select + 1 > 7 and 1 or music_select + 1
  active_actor(kMusicTable[music_select].key)
  set_actor_color(kMusicTable[music_select].name, 0xAA, 0xAA, 0xFF)
  return music_select
end

local function select_up(music_select)
  sleep_actor(kMusicTable[music_select].key)
  set_actor_color(kMusicTable[music_select].name, 0x64, 0x64, 0x80)
  music_select = music_select - 1 < 1 and 7 or music_select - 1
  active_actor(kMusicTable[music_select].key)
  set_actor_color(kMusicTable[music_select].name, 0xAA, 0xAA, 0xFF)
  return music_select
end

local function cancel(menu_select)
  stop_se('cancel')
  play_se('cancel', 1)
  coroutine.yield()
  clean()
  title(menu_select)
end

local function update(menu_select)
  local music_select = 1
  while true do
    if key_triger(kDown) == true then
      music_select = select_down(music_select)
    elseif key_triger(kUp) == true then
      music_select = select_up(music_select)
    elseif key_triger(kCross) == true then
      cancel(menu_select)
    end
    coroutine.yield()
  end
end

function music(menu_select)
  init()
  update(menu_select)
end
